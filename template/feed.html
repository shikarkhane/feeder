{% extends "base.html" %}

{% block jscripts %}
	$(function() {
		function setCoordinateCookie(position){
			  	$.cookie('MyLat', position.coords.latitude); // Storing latitude value
				$.cookie('MyLon', position.coords.longitude); // Storing longitude value
				window.location.replace("http://localhost:8888/" +  $.cookie("MyLat") + "/" +  $.cookie("MyLon") + "/from/0/");			
			 };
  
	 	function couldntFetchPosition(msg){
  				alert('Couldnt find your location!\n' + msg );
	  		};
	  	if ($.cookie('MyLat') == null){
		  	if (navigator.geolocation){
			    	navigator.geolocation.getCurrentPosition(setCoordinateCookie, couldntFetchPosition);
			    }
		};
	    
		$( '.x_minutes_ago' ).each(function(){
			var $span = $(this);
			var fulldate = formatDate(new Date($span.text()));
			$span.html(moment(fulldate, "YYYY-MM-DDTHH:mm:ssZ").fromNow());
		});
		
			// Callback for refresh on pull-down
			$('#hook').hook({
			  reloadPage: false,
			  reloadEl: function(){
			    window.location.replace("http://localhost:8888/");
			  }
			});
		
	});



{% end %}
{% block feed %}
<div id="hook" class="hook" ><div class="hook-loader"><div class="hook-spinner"></div></div></div>
	<div class="main-feed">
  	{% for c in posts %}
			<div class="main-post row-fluid well">
				{% if c.content_img_url %}
					<a  href='{{ c.content_img_url }}' target="_blank">
				{% end %}		
			
				<div class="span1">
					<span><img src="{{ c.user_img_url }}" onError="this.onerror=null;this.src='/static/images/user_placeholder.png';" class="img-responsive"/></span>
					</div>
				<div class="span10">
					<span>{{ c.text }}</span>
				</div>
				<div class="span1 elapsed_time">
					<span class="x_minutes_ago">{{ c.created.strftime("%Y-%m-%dT%H:%M:%S.%fZ") }}</span>
				</div>
			{% if c.content_img_url %}
				</a>
			{% end %}
				
			</div>
	{% end %}
	</div>
	<div class="button">
		<form action="{{ next_link }}">
		    <input id="nextbutton" type="submit" value="More!">
		</form>
	</div>

{% end %}